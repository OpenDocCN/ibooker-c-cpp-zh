<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 7. Libraries"><div class="chapter" id="smallerc-CHP-7">
<h1><span class="label">Chapter 7. </span>Libraries</h1>


<p>One of C’s best qualities is the minimal adornment present in its compiled
code. A favorite snipe at some more modern languages like Java is the <a data-type="indexterm" data-primary="&quot;Hello, World!&quot; programs" data-secondary="size comparison, C and Java" data-primary-sortas="Hello, World" id="idm45018722101224"/>size of the
“Hello, World” program. Our very first program back in
<a data-type="xref" href="ch01.xhtml#smallerc-CHP-1-SECT-2.2">“Creating a C ‘Hello, World’”</a> takes up a little over 16Kb on my Linux machine
without any optimizations. Achieving the same output from a standalone executable
on the same system using Java, though, requires tens of megabytes and much, much
more effort to build. That’s not an entirely fair comparison since the Java
hello application needs the entire Java runtime baked into the executable, but
that’s also the point: C makes it easy to create lean code for a given
system.</p>

<p>That ease is great when we’re tackling small things like “Hello,
World” or even most of the examples from past chapters. But as we get
ready to jump into the world of microcontrollers and Arduino, we’re
left worrying about re-creating our own solutions to some pretty mundane
problems. For example, we’ve written some of our own functions to
compare strings. We wrote a fancier program to encode base64 content. That
stuff is fun, but do we always have to do this type of work from scratch?</p>

<p>Happily, the <a data-type="indexterm" data-primary="libraries" data-secondary="purpose of" id="idm45018722097368"/>answer to that question is: no. C supports the notion of using
a <em>library</em> for quick, friendly expansion of its capabilities—without
losing its lean profile for the final executable. A library is a bundle of
code that can be imported into your projects to add new capabilities, like
working with strings or talking to a wireless network. But the key to using
libraries is that you only need to add the
one that contains the features you need. That Java hello application
would have latent support for creating an entire graphical interface and opening
network connections, even though they would not be used just to print some
text in a terminal window.</p>

<p>With Arduino, for example, you’ll find libraries for most of the popular
sensors like temperature components or light-level resistors and outputs like
LEDs and LCD displays. You won’t have to write your own device driver to
use a piece of electronic paper or change the color of an RGB LED. You can
load up a library and get to work on <em>what</em> you want to display on that e-paper,
and not worry about <em>how</em>.</p>






<section data-type="sect1" data-pdf-bookmark="The C Standard Library"><div class="sect1" id="smallerc-CHP-7-SECT-1">
<h1>The C Standard Library</h1>

<p>We have<a data-type="indexterm" data-primary="libraries" data-secondary="C standard library" id="idm45018722091272"/><a data-type="indexterm" data-primary="C standard library" id="idm45018722090264"/> already used a couple libraries on our path to this point in the book.
Even our very first program needed the <em>stdio.h</em> header for access to the
<code>printf()</code> function. And our most recent work on pointers in <a data-type="xref" href="ch06.xhtml#smallerc-CHP-6">Chapter 6</a>
required the <code>malloc()</code> function found in the <em>stdlib.h</em> header. We didn’t
have to do much to get access to those bits. Indeed, we just wrote an <code>#include</code> statement at the top of our program and off <span class="keep-together">we went!</span></p>

<p>The reason these functions are so easy to incorporate is that they belong to the C standard
library. Every C compiler or development environment
will have this library available. It may be packaged differently on different platforms
(such as including or excluding the math functions), but you can always count on the overall content being ready for inclusion. I can’t cover everything in the library, but I do want to highlight some useful functions and the headers
that provide them. In <a data-type="xref" href="#smallerc-CHP-7-SECT-2">“Putting It Together”</a>, I’ll also cover where to
look for other libraries that tackle a wider range of features.</p>








<section data-type="sect2" data-pdf-bookmark="stdio.h"><div class="sect2" id="smallerc-CHP-7-SECT-1.1">
<h2>stdio.h</h2>

<p>Obviously<a data-type="indexterm" data-primary="libraries" data-secondary="C standard library" data-tertiary="stdio.h" id="idm45018722082088"/><a data-type="indexterm" data-primary="C standard library" data-secondary="stdio.h" id="idm45018722080808"/><a data-type="indexterm" data-primary="stdio.h" id="idm45018722079864"/> we’ve been using the <em>stdio.h</em> header from the very start. We have already
used the two most useful functions (for our purposes): <code>printf()</code>
and <code>scanf()</code>. The other functions in this header revolve around access to files.
The microcontrollers we’ll be working with in the coming chapters do sometimes
have filesystems, but the types of programs we’ll be writing won’t need
that particular feature. Still, if you do want to work with files on a desktop or
high-powered microcontroller, this header is a good place to start!</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="stdlib.h"><div class="sect2" id="smallerc-CHP-7-SECT-1.2">
<h2>stdlib.h</h2>

<p>We <a data-type="indexterm" data-primary="libraries" data-secondary="C standard library" data-tertiary="stdlib.h" id="libraries-c-stdlib"/><a data-type="indexterm" data-primary="C standard library" data-secondary="stdlib.h" id="c-library-stdlib"/><a data-type="indexterm" data-primary="stdlib.h" id="stdlib"/>have also seen a few functions from <em>stdlib.h</em>, namely <code>malloc()</code> and <code>free()</code>.
But this header has a few more useful tricks worth mentioning.</p>










<section data-type="sect3" data-pdf-bookmark="atoi()"><div class="sect3" id="smallerc-CHP-7-SECT-1.2.1">
<h3>atoi()</h3>

<p>In <a data-type="xref" href="ch05.xhtml#smallerc-CHP-5-SECT-7.2">“Command-Line Arguments and main()”</a>, I <a data-type="indexterm" data-primary="stdlib.h" data-secondary="atoi() function" id="stdlib-atoi"/><a data-type="indexterm" data-primary="functions" data-secondary="atoi()" id="functions-atoi-stdlib"/><a data-type="indexterm" data-primary="atoi() function" id="atoi-stdlib"/><a data-type="indexterm" data-primary="strings" data-secondary="converting to numbers" id="strings-convert-number"/><a data-type="indexterm" data-primary="numbers" data-secondary="converting strings to" id="numbers-convert-strings"/><a data-type="indexterm" data-primary="converting strings to numbers" id="convert-strings-numbers"/>gave you an exercise to convert a string to a number.
The “extra credit” note mentioned using <em>stdlib.h</em> to get access to C’s
standard conversion function: <code>atoi()</code>. There are two other converters for other
base types: <code>atol()</code> converts <a data-type="indexterm" data-primary="functions" data-secondary="atol()" id="idm45018722058632"/><a data-type="indexterm" data-primary="atol() function" id="idm45018722057624"/><a data-type="indexterm" data-primary="functions" data-secondary="atof()" id="idm45018722056952"/><a data-type="indexterm" data-primary="atof() function" id="idm45018722056008"/>to a <code>long</code> value, and <code>atof()</code> converts to a
floating point type, but contrary to the final letter in the function’s
name, <code>atof()</code> returns a <code>double</code> value. (You can always cast that to the
lower-precision <code>float</code> type if needed.)</p>

<p>The solution to that extra exercise, <a href="https://oreil.ly/x8J8O"><em>ch07/sum2.c</em></a>, highlights just how simple converting can
be if you include the necessary header file:</p>

<pre data-type="programlisting" data-code-language="c"><code class="cp">#include &lt;stdio.h&gt;</code>
<code class="cp">#include &lt;stdlib.h&gt;</code>

<code class="kt">int</code> <code class="nf">main</code><code class="p">(</code><code class="kt">int</code> <code class="n">argc</code><code class="p">,</code> <code class="kt">char</code> <code class="o">*</code><code class="n">argv</code><code class="p">[])</code> <code class="p">{</code>
  <code class="kt">int</code> <code class="n">total</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>
  <code class="k">for</code> <code class="p">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">1</code><code class="p">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="n">argc</code><code class="p">;</code> <code class="n">i</code><code class="o">++</code><code class="p">)</code> <code class="p">{</code>
    <code class="n">total</code> <code class="o">+=</code> <code class="n">atoi</code><code class="p">(</code><code class="n">argv</code><code class="p">[</code><code class="n">i</code><code class="p">]);</code>
  <code class="p">}</code>
  <code class="n">printf</code><code class="p">(</code><code class="s">"The sum of these %d numbers is %d</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code> <code class="n">argc</code> <code class="o">-</code> <code class="mi">1</code><code class="p">,</code> <code class="n">total</code><code class="p">);</code>
<code class="p">}</code></pre>

<p>Pretty easy! Which is, of course, the hope in using a library function like this.
You <em>could</em> write this conversion code yourself, but you can save a lot of time
(and a fair amount of debugging) if you can find an appropriate library
function to use instead.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>Do be a little careful with these functions. They stop
parsing the string when they hit a nondigit character. If you attempt
to convert the word “one” to a number, for example, that
parsing stops immediately and <code>atoi()</code> (or the others) will return a 0
without any errors. If 0 can appear as a legitimate value in your string,
you’ll need to add your own validity checks before calling<a data-type="indexterm" data-primary="stdlib.h" data-secondary="atoi() function" data-startref="stdlib-atoi" id="idm45018721986680"/><a data-type="indexterm" data-primary="functions" data-secondary="atoi()" data-startref="functions-atoi-stdlib" id="idm45018721985544"/><a data-type="indexterm" data-primary="atoi() function" data-startref="atoi-stdlib" id="idm45018721984328"/><a data-type="indexterm" data-primary="strings" data-secondary="converting to numbers" data-startref="strings-convert-number" id="idm45018721983384"/><a data-type="indexterm" data-primary="numbers" data-secondary="converting strings to" data-startref="numbers-convert-strings" id="idm45018721982168"/><a data-type="indexterm" data-primary="converting strings to numbers" data-startref="convert-strings-numbers" id="idm45018721980952"/> them.</p>
</div>
</div></section>













<section data-type="sect3" data-pdf-bookmark="rand() and srand()"><div class="sect3" id="smallerc-CHP-7-SECT-1.2.2">
<h3>rand() and srand()</h3>

<p>Random values <a data-type="indexterm" data-primary="stdlib.h" data-secondary="rand() function" id="stdlib-rand"/><a data-type="indexterm" data-primary="functions" data-secondary="rand()" id="functions-rand"/><a data-type="indexterm" data-primary="rand() function" id="rand"/><a data-type="indexterm" data-primary="stdlib.h" data-secondary="srand() function" id="stdlib-srand"/><a data-type="indexterm" data-primary="functions" data-secondary="srand()" id="functions-srand"/><a data-type="indexterm" data-primary="srand() function" id="srand"/><a data-type="indexterm" data-primary="random numbers" id="random"/>play a fun role in many situations. Want to vary the colors of
your LED lamp? Want to shuffle a virtual deck of cards? Need to simulate
potential communication delays? Random numbers to the rescue!</p>

<p>The <code>rand()</code> function returns a pseudorandom number between 0 and a
constant (well, technically a <em>macro</em>; more on these in <a data-type="xref" href="ch09.xhtml#smallerC-CHP-9-SECT-1.1">“Special Values”</a>),
<code>RAND_MAX</code>, also defined in <em>stdlib.h</em>. I say “pseudorandom” because
the “random” number you get back is the product of an algorithm.<sup><a data-type="noteref" id="idm45018721966312-marker" href="ch07.xhtml#idm45018721966312">1</a></sup></p>

<p>A related function, <code>srand()</code>, can be
used<a data-type="indexterm" data-primary="seeding random numbers" id="seed"/> to <em>seed</em> the random number generating algorithm. The “seed”
value is the starting point for the algorithm before it goes hopping around producing
a nice variety of values. You can use <code>srand()</code> to supply new values every time
your program runs—using the current timestamp, for example—or you can
use the seed to produce a known list of numbers. That might seem like a strange
thing to want, but it can be useful in testing.</p>

<p>Let’s try out these two functions to get a feel for their use. Take a look
at <a href="https://oreil.ly/sst4C"><em>ch07/random.c</em></a>:</p>

<pre data-type="programlisting" data-code-language="c"><code class="cp">#include &lt;stdio.h&gt;</code>
<code class="cp">#include &lt;stdlib.h&gt;</code>
<code class="cp">#include &lt;time.h&gt;</code>

<code class="kt">int</code> <code class="nf">main</code><code class="p">()</code> <code class="p">{</code>
  <code class="n">printf</code><code class="p">(</code><code class="s">"RAND_MAX: %d</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code> <code class="n">RAND_MAX</code><code class="p">);</code>
  <code class="kt">unsigned</code> <code class="kt">int</code> <code class="n">r1</code> <code class="o">=</code> <code class="n">rand</code><code class="p">();</code>
  <code class="n">printf</code><code class="p">(</code><code class="s">"First random number: %d</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code> <code class="n">r1</code><code class="p">);</code>
  <code class="n">srand</code><code class="p">(</code><code class="mi">5</code><code class="p">);</code>
  <code class="n">printf</code><code class="p">(</code><code class="s">"Second random number: %d</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code> <code class="n">rand</code><code class="p">());</code>
  <code class="n">srand</code><code class="p">(</code><code class="n">time</code><code class="p">(</code><code class="nb">NULL</code><code class="p">));</code>
  <code class="n">printf</code><code class="p">(</code><code class="s">"Third random number: %d</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code> <code class="n">rand</code><code class="p">());</code>
  <code class="kt">unsigned</code> <code class="kt">int</code> <code class="n">pin</code> <code class="o">=</code> <code class="n">rand</code><code class="p">()</code> <code class="o">%</code> <code class="mi">9000</code> <code class="o">+</code> <code class="mi">1000</code><code class="p">;</code>
  <code class="n">printf</code><code class="p">(</code><code class="s">"Random four digit number: %d</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code> <code class="n">pin</code><code class="p">);</code>
<code class="p">}</code></pre>

<p>And let’s compile and run it to see the output:</p>

<pre data-type="programlisting">ch07$ gcc random.c
ch07$ ./a.out
RAND_MAX: 2147483647
First random number: 1804289383
Second random number: 590011675
Third random number: 1205842387
Random four digit number: 7783

ch07$ ./a.out
RAND_MAX: 2147483647
First random number: 1804289383
Second random number: 590011675
Third random number: 612877372
Random four digit number: 5454</pre>

<p>On my system, then, the maximum value returned by <code>rand()</code> is 2147483647. The first
number we generate should be between 0 and 2147483647, and so it is. The second
number we generate will be in the same range, but it comes after we provide a new
seed value to <code>srand()</code>, so hopefully it’s different than <code>r1</code>, and that
bears out.</p>

<p>But look at those first two “random” numbers in the output of our
second run. They’re exactly the same! Hardly random. As I mentioned,
<code>rand()</code> is a pseudorandom generator. The default seed for the generating
algorithm is 1 if you never call <code>srand()</code>. But if you call it with a constant
like 5, that’s no better. It will be a different sequence of numbers,
but every time you run the program it will be the same “different”
sequence.</p>

<p>So, in order to get different pseudorandom numbers,
you need to provide a seed that changes every time you run your program.
The most common trick is to do what I did by including yet another header,
<em>time.h</em> (see <a data-type="xref" href="#smallerc-CHP-7-SECT-1.5">“time.h”</a>) and pull in the current timestamp (seconds
since January 1, 1970). As long as we don’t manage to start the program
twice in one second, we’ll get new sequences each run. You can see that
seed turned out fine in the two runs above as the third number is indeed
different between them.</p>

<p>With that better seed<sup><a data-type="noteref" id="idm45018721851352-marker" href="ch07.xhtml#idm45018721851352">2</a></sup> in place, subsequent calls to <code>rand()</code> should look random
from execution to execution. We can see that benefit with the PIN we generate
for our final random number. The PIN is bounded using a popular trick for
getting a random number in a range. You use the remainder operator to make sure
you get an appropriately limited range, and then add a base value. For the
PIN to have exactly four digits, we use a base of 1000 and a <a data-type="indexterm" data-primary="seeding random numbers" data-startref="seed" id="idm45018721849544"/><a data-type="indexterm" data-primary="stdlib.h" data-secondary="rand() function" data-startref="stdlib-rand" id="idm45018721848568"/><a data-type="indexterm" data-primary="functions" data-secondary="rand()" data-startref="functions-rand" id="idm45018721847352"/><a data-type="indexterm" data-primary="rand() function" data-startref="rand" id="idm45018721846136"/><a data-type="indexterm" data-primary="stdlib.h" data-secondary="srand() function" data-startref="stdlib-srand" id="idm45018721845192"/><a data-type="indexterm" data-primary="functions" data-secondary="srand()" data-startref="functions-srand" id="idm45018721843976"/><a data-type="indexterm" data-primary="srand() function" data-startref="srand" id="idm45018721702136"/><a data-type="indexterm" data-primary="random numbers" data-startref="random" id="idm45018721701192"/>range of 9000
(0 to 8999 inclusive).</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="exit()"><div class="sect3" id="smallerc-CHP-7-SECT-1.2.3">
<h3>exit()</h3>

<p>The <a data-type="indexterm" data-primary="stdlib.h" data-secondary="exit() function" id="stdlib-exit"/><a data-type="indexterm" data-primary="functions" data-secondary="exit()" id="functions-exit"/><a data-type="indexterm" data-primary="exit() function" id="exit"/><a data-type="indexterm" data-primary="return statement" data-secondary="exit() function and" id="return-exit-statement"/>final function from <em>stdlib.h</em> that I want to highlight is the <code>exit()</code>
function. In <a data-type="xref" href="ch05.xhtml#smallerc-CHP-5-SECT-7.1">“Return values and main()”</a> we looked at using the <code>return</code> statement
to end your program and optionally return a value from the
<code>main()</code> function to provide some status information to the operating
system.</p>

<p>There is also a separate <code>exit()</code> function that takes an <code>int</code> argument that is used
for the same exit code value as the <code>return</code> statement in the <code>main()</code> method. The
difference between using <code>exit()</code> and returning from <code>main()</code>
is that <code>exit()</code> can be called from any function and immediately
quits the application. For example, we could write a “confirmation”
function that asks the user if they are sure they want to quit. If they answer
with a <code><em>y</em></code>, then we can use <code>exit()</code> at that point rather than returning
some sentinel value to <code>main()</code> and then using <code>return</code>. Take a look at
<a href="https://oreil.ly/W5lIr"><em>ch07/areyousure.c</em></a>:</p>
<pre data-type="programlisting" data-code-language="c">
<code class="cp">#include &lt;stdio.h&gt;</code>
<code class="cp">#include &lt;stdlib.h&gt;</code>

<code class="kt">void</code> <code class="nf">confirm</code><code class="p">()</code> <code class="p">{</code>
  <code class="kt">char</code> <code class="n">answer</code><code class="p">;</code>
  <code class="n">printf</code><code class="p">(</code><code class="s">"Are you sure you want to exit? (y/n) "</code><code class="p">);</code>
  <code class="n">scanf</code><code class="p">(</code><code class="s">"%c"</code><code class="p">,</code> <code class="o">&amp;</code><code class="n">answer</code><code class="p">);</code>
  <code class="k">if</code> <code class="p">(</code><code class="n">answer</code> <code class="o">==</code> <code class="sc">'y'</code> <code class="o">||</code> <code class="n">answer</code> <code class="o">==</code> <code class="sc">'Y'</code><code class="p">)</code> <code class="p">{</code>
    <code class="n">printf</code><code class="p">(</code><code class="s">"Bye</code><code class="se">\n\n</code><code class="s">"</code><code class="p">);</code>
    <code class="n">exit</code><code class="p">(</code><code class="mi">0</code><code class="p">);</code>
    <code class="n">printf</code><code class="p">(</code><code class="s">"This will never be printed.</code><code class="se">\n</code><code class="s">"</code><code class="p">);</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="kt">int</code> <code class="nf">main</code><code class="p">()</code> <code class="p">{</code>
  <code class="n">printf</code><code class="p">(</code><code class="s">"In main... let's try exiting.</code><code class="se">\n</code><code class="s">"</code><code class="p">);</code>
  <code class="n">confirm</code><code class="p">();</code>
  <code class="n">printf</code><code class="p">(</code><code class="s">"Glad you decided not to leave.</code><code class="se">\n</code><code class="s">"</code><code class="p">);</code>
<code class="p">}</code>
</pre>

<p>And here is the output from two runs:</p>

<pre data-type="programlisting">ch07$ gcc areyousure.c
ch07$ ./a.out
In main... let's try exiting.
Are you sure you want to exit? (y/n) y
Bye

ch07$ ./a.out
In main... let's try exiting.
Are you sure you want to exit? (y/n) n
Glad you decided not to leave.</pre>

<p>Notice that when we use <code>exit()</code>, we don’t go back to the <code>main()</code>
function or even finish the code in our <code>confirm()</code> function itself.
We really do exit the program
and supply an exit code to the operating system.</p>

<p>Inside <code>main()</code>, by<a data-type="indexterm" data-primary="functions" data-secondary="main()" data-tertiary="exiting" id="idm45018721574248"/><a data-type="indexterm" data-primary="main() function" data-secondary="exiting" id="idm45018721572968"/> the way, it mostly doesn’t matter whether you use
<code>return</code> or <code>exit()</code>, although the former is more “polite.” (For
example, any cleanup from completing the <code>main()</code> function will still run
if you use <code>return</code>. That same cleanup would be skipped if you use <code>exit()</code>.) It is also worth noting that simply making it to the end of the <code>main()</code> body
as we have been doing all along is a fine and popular way to finish your
program when there were<a data-type="indexterm" data-primary="stdlib.h" data-secondary="exit() function" data-startref="stdlib-exit" id="idm45018721569112"/><a data-type="indexterm" data-primary="functions" data-secondary="exit()" data-startref="functions-exit" id="idm45018721567864"/><a data-type="indexterm" data-primary="exit() function" data-startref="exit" id="idm45018721566648"/><a data-type="indexterm" data-primary="return statement" data-secondary="exit() function and" data-startref="return-exit-statement" id="idm45018721565704"/><a data-type="indexterm" data-primary="libraries" data-secondary="C standard library" data-tertiary="stdlib.h" data-startref="libraries-c-stdlib" id="idm45018721564488"/><a data-type="indexterm" data-primary="C standard library" data-secondary="stdlib.h" data-startref="c-library-stdlib" id="idm45018721563000"/><a data-type="indexterm" data-primary="stdlib.h" data-startref="stdlib" id="idm45018721561784"/> no errors.</p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="string.h"><div class="sect2" id="smallerc-CHP-7-SECT-1.3">
<h2>string.h</h2>

<p>Strings <a data-type="indexterm" data-primary="libraries" data-secondary="C standard library" data-tertiary="string.h" id="libraries-c-string"/><a data-type="indexterm" data-primary="C standard library" data-secondary="string.h" id="c-library-string"/><a data-type="indexterm" data-primary="string.h" id="string-library"/><a data-type="indexterm" data-primary="strings" data-secondary="string.h" id="strings-string"/>are so common and so useful that they even have their own header file.
The <em>string.h</em> header can be added to any program where you need
to compare or manipulate strings beyond simply storing and printing them.
This header describes more functions than we have time to cover here, but
there are some import utilities we want to highlight<a data-type="indexterm" data-primary="functions" data-secondary="for strings" data-secondary-sortas="strings" id="functions-strings"/><a data-type="indexterm" data-primary="strlen() function" id="idm45018721551416"/><a data-type="indexterm" data-primary="strcmp() function" id="idm45018721550744"/><a data-type="indexterm" data-primary="strncmp() function" id="idm45018721550072"/><a data-type="indexterm" data-primary="strcpy() function" id="idm45018721549400"/><a data-type="indexterm" data-primary="strncpy() function" id="idm45018721548728"/> in
<a data-type="xref" href="#smallerc-CHP-7-TABLE-string-lib">Table 7-1</a>.</p>
<table id="smallerc-CHP-7-TABLE-string-lib">
<caption><span class="label">Table 7-1. </span>Useful string functions</caption>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><span class="keep-together"><code>strlen(char *s)</code></span></p></td>
<td><p>Calculate the length of a string (not including the final null character)</p></td>
</tr>
<tr>
<td><p><span class="keep-together"><code>strcmp(char *s1, char *s2)</code></span></p></td>
<td><p>Compare two strings. Return -1 if s1 &lt; s2, 0 if s1 == s2, and 1 if s1 &gt; s2</p></td>
</tr>
<tr>
<td><p><span class="keep-together"><code>strncmp(char *s1, char *s2, int n)</code></span></p></td>
<td><p>Compare at most n bytes of s1 and s2 (results similar to strcmp)</p></td>
</tr>
<tr>
<td><p><span class="keep-together"><code>strcpy(char *dest, char *src)</code></span></p></td>
<td><p>Copy src to dest</p></td>
</tr>
<tr>
<td><p><span class="keep-together"><code>strncpy(char *dest, char *src, int n)</code></span></p></td>
<td><p>Copy at most n bytes of src to dest</p></td>
</tr>
<tr class="pagebreak-before">
<td><p><span class="keep-together"><code>strcat(char *dest, char *src)</code></span></p></td>
<td><p>Append src to dest</p></td>
</tr>
<tr>
<td><p><span class="keep-together"><code>strncat(char *dest, char *src, int n</code></span>)</p></td>
<td><p>Append at most n bytes of src to dest</p></td>
</tr>
</tbody>
</table>

<p>We can<a data-type="indexterm" data-primary="strcat() function" id="idm45018721527912"/><a data-type="indexterm" data-primary="strncat() function" id="idm45018721527176"/> demonstrate all of these functions in a simple program,
<a href="https://oreil.ly/dzycy"><em>ch07/fullname.c</em></a>,
by asking the user for their full
name in pieces and (safely!) putting it together at the end. If we find we’re
interacting with Dennis M. Ritchie, we’ll thank him for writing C.</p>

<pre data-type="programlisting" data-code-language="c"><code class="cp">#include &lt;stdio.h&gt;</code>
<code class="cp">#include &lt;string.h&gt;</code>

<code class="kt">int</code> <code class="nf">main</code><code class="p">()</code> <code class="p">{</code>
  <code class="kt">char</code> <code class="n">first</code><code class="p">[</code><code class="mi">20</code><code class="p">];</code>
  <code class="kt">char</code> <code class="n">middle</code><code class="p">[</code><code class="mi">20</code><code class="p">];</code>
  <code class="kt">char</code> <code class="n">last</code><code class="p">[</code><code class="mi">20</code><code class="p">];</code>
  <code class="kt">char</code> <code class="n">full</code><code class="p">[</code><code class="mi">60</code><code class="p">];</code>
  <code class="kt">char</code> <code class="n">spacer</code><code class="p">[</code><code class="mi">2</code><code class="p">]</code> <code class="o">=</code> <code class="s">" "</code><code class="p">;</code>

  <code class="n">printf</code><code class="p">(</code><code class="s">"Please enter your first name: "</code><code class="p">);</code>
  <code class="n">scanf</code><code class="p">(</code><code class="s">"%s"</code><code class="p">,</code> <code class="n">first</code><code class="p">);</code>
  <code class="n">printf</code><code class="p">(</code><code class="s">"Please enter your middle name or initial: "</code><code class="p">);</code>
  <code class="n">scanf</code><code class="p">(</code><code class="s">"%s"</code><code class="p">,</code> <code class="n">middle</code><code class="p">);</code>
  <code class="n">printf</code><code class="p">(</code><code class="s">"Please enter your last name: "</code><code class="p">);</code>
  <code class="n">scanf</code><code class="p">(</code><code class="s">"%s"</code><code class="p">,</code> <code class="n">last</code><code class="p">);</code>

  <code class="c1">// First, assemble the full name</code>
  <code class="n">strncpy</code><code class="p">(</code><code class="n">full</code><code class="p">,</code> <code class="n">first</code><code class="p">,</code> <code class="mi">20</code><code class="p">);</code>
  <code class="n">strncat</code><code class="p">(</code><code class="n">full</code><code class="p">,</code> <code class="n">spacer</code><code class="p">,</code> <code class="mi">40</code><code class="p">);</code>
  <code class="n">strncat</code><code class="p">(</code><code class="n">full</code><code class="p">,</code> <code class="n">middle</code><code class="p">,</code> <code class="mi">39</code><code class="p">);</code>
  <code class="n">strncat</code><code class="p">(</code><code class="n">full</code><code class="p">,</code> <code class="n">spacer</code><code class="p">,</code> <code class="mi">20</code><code class="p">);</code>
  <code class="n">strncat</code><code class="p">(</code><code class="n">full</code><code class="p">,</code> <code class="n">last</code><code class="p">,</code> <code class="mi">19</code><code class="p">);</code>

  <code class="n">printf</code><code class="p">(</code><code class="s">"Well hello, %s!</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code> <code class="n">full</code><code class="p">);</code>

  <code class="kt">int</code> <code class="n">dennislen</code> <code class="o">=</code> <code class="mi">17</code><code class="p">;</code>  <code class="c1">// length of "Dennis M. Ritchie"</code>
  <code class="k">if</code> <code class="p">(</code><code class="n">strlen</code><code class="p">(</code><code class="n">full</code><code class="p">)</code> <code class="o">==</code> <code class="n">dennislen</code> <code class="o">&amp;&amp;</code>
      <code class="n">strncmp</code><code class="p">(</code><code class="s">"Dennis M. Ritchie"</code><code class="p">,</code> <code class="n">full</code><code class="p">,</code> <code class="n">dennislen</code><code class="p">)</code> <code class="o">==</code> <code class="mi">0</code><code class="p">)</code>
  <code class="p">{</code>
    <code class="n">printf</code><code class="p">(</code><code class="s">"Thanks for writing C!</code><code class="se">\n</code><code class="s">"</code><code class="p">);</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p>And an example run:</p>

<pre data-type="programlisting">ch07$ gcc fullname.c
ch07$ ./a.out
Please enter your first name: Alice
Please enter your middle name or initial: B.
Please enter your last name: Toklas
Well hello, Alice B. Toklas!</pre>

<p>Give this <a data-type="indexterm" data-primary="functions" data-secondary="for strings" data-secondary-sortas="strings" data-startref="functions-strings" id="idm45018721489352"/>program a try yourself. If you do enter Dennis’s name
(including the period after his middle initial: “M.”), do
you get the thank-you message as expected?</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>It’s a <a data-type="indexterm" data-primary="strncat() function" id="idm45018721345416"/><a data-type="indexterm" data-primary="warnings" data-secondary="concatenated string length" id="idm45018721344680"/>common mistake to set the maximum number of characters to
concatenate in <code>strncat()</code> to the length of the source string. Instead, you should
set it to the maximum number of characters remaining in your destination. Your
compiler may warn you about this mistake with a “specified bound X
equals source length” message. (X, of course, would be the bound
you specified when calling <code>strncat()</code>.) It’s just a warning, and you
might well have exactly the length of your source remaining. But if you
see the warning, double-check that you didn’t use the source length by
accident.</p>
</div>

<p>As another<a data-type="indexterm" data-primary="arrays" data-secondary="default values" id="arrays-default"/><a data-type="indexterm" data-primary="default values for arrays" id="default-arrays"/> example, we can revisit the notion of default values and
overwriting arrays from <a data-type="xref" href="ch04.xhtml#smallerc-CHP-4-SECT-1.2.1">“Initializing strings”</a>.
You can delay the initialization of a character
array until you know what the user has done. We can declare—but not
initialize—a string, use it with <code>scanf()</code>, and then go back to the
default if the user didn’t give us a good alternate value.</p>

<p>Let’s try this with a question about the background color of some
future, amazing application. We might assume a dark theme with a black
background. We can prompt the user for a different value, or have them
simply hit the Return key without entering a value if they want
to keep the default. Here’s
<a href="https://oreil.ly/a89Jd"><em>ch07/background.c</em></a>:</p>

<pre data-type="programlisting" data-code-language="c"><code class="cp">#</code><code class="cp">include &lt;stdio.h&gt;</code><code class="cp">
</code><code class="cp">#</code><code class="cp">include &lt;string.h&gt;</code><code class="cp">
</code><code>
</code><code class="kt">int</code><code> </code><code class="nf">main</code><code class="p">(</code><code class="p">)</code><code> </code><code class="p">{</code><code>
</code><code>  </code><code class="kt">char</code><code> </code><code class="n">background</code><code class="p">[</code><code class="mi">20</code><code class="p">]</code><code class="p">;</code><code>                                     </code><a class="co" id="co_libraries_CO1-1" href="#callout_libraries_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
  </code><code class="n">printf</code><code class="p">(</code><code class="s">"</code><code class="s">Enter a background color or return for the default: </code><code class="s">"</code><code class="p">)</code><code class="p">;</code><code>
</code><code>  </code><code class="n">scanf</code><code class="p">(</code><code class="s">"</code><code class="s">%[^</code><code class="se">\n</code><code class="s">]s</code><code class="s">"</code><code class="p">,</code><code> </code><code class="n">background</code><code class="p">)</code><code class="p">;</code><code>                            </code><a class="co" id="co_libraries_CO1-2" href="#callout_libraries_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
  </code><code class="k">if</code><code> </code><code class="p">(</code><code class="n">strlen</code><code class="p">(</code><code class="n">background</code><code class="p">)</code><code> </code><code class="o">=</code><code class="o">=</code><code> </code><code class="mi">0</code><code class="p">)</code><code> </code><code class="p">{</code><code>                           </code><a class="co" id="co_libraries_CO1-3" href="#callout_libraries_CO1-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
    </code><code class="n">strcpy</code><code class="p">(</code><code class="n">background</code><code class="p">,</code><code> </code><code class="s">"</code><code class="s">black</code><code class="s">"</code><code class="p">)</code><code class="p">;</code><code>
</code><code>  </code><code class="p">}</code><code>
</code><code>  </code><code class="n">printf</code><code class="p">(</code><code class="s">"</code><code class="s">The background color is now %s.</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code><code> </code><code class="n">background</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" id="co_libraries_CO1-4" href="#callout_libraries_CO1-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_libraries_CO1-1" href="#co_libraries_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Declare a string with enough capacity, but don’t set it to anything.</p></dd>
<dt><a class="co" id="callout_libraries_CO1-2" href="#co_libraries_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Get input from the user and store it in our array.</p></dd>
<dt><a class="co" id="callout_libraries_CO1-3" href="#co_libraries_CO1-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>If the array is empty after prompting the user, store our default.</p></dd>
<dt><a class="co" id="callout_libraries_CO1-4" href="#co_libraries_CO1-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Show the final value, either from the user or from our default.</p></dd>
</dl>

<p class="pagebreak-before less_space">And here are some sample runs, including one where we keep the black
background:</p>

<pre data-type="programlisting">ch07$ gcc background.c
ch07$ ./a.out
Enter a background color or return for the default: blue
The background color is now blue.
ch07$ ./a.out
Enter a background color or return for the default: white
The background color is now white.
ch07$ ./a.out
Enter a background color or return for the default:
The background color is now black.</pre>

<p>If you are inviting the user to supply a value, just remember to allocate
sufficient room in your array to contain whatever response the user might
give you. If you can’t trust your <a data-type="indexterm" data-primary="functions" data-secondary="scanf()" id="idm45018721136600"/><a data-type="indexterm" data-primary="scanf() function" id="idm45018721135752"/>users, <code>scanf()</code> has another trick
that you can deploy. Just like the format specifiers in <code>printf()</code>, you can
add a width to any input field in <code>scanf()</code>. For our previous example, say,
we could change to an explicit limit of 19 (saving room for that final
<code>'\0'</code> character):</p>

<pre data-type="programlisting" data-code-language="c">  <code class="n">scanf</code><code class="p">(</code><code class="s">"%19[^</code><code class="se">\n</code><code class="s">]s"</code><code class="p">,</code> <code class="n">background</code><code class="p">);</code></pre>

<p>Easy peasy. It does look quite dense, but it’s a nice option for limited
devices where you might not be able to allocate a lot of extra space in case of
verbose <a data-type="indexterm" data-primary="arrays" data-secondary="default values" data-startref="arrays-default" id="idm45018721128808"/><a data-type="indexterm" data-primary="default values for arrays" data-startref="default-arrays" id="idm45018721126888"/><a data-type="indexterm" data-primary="libraries" data-secondary="C standard library" data-tertiary="string.h" data-startref="libraries-c-string" id="idm45018721125976"/><a data-type="indexterm" data-primary="C standard library" data-secondary="string.h" data-startref="c-library-string" id="idm45018721124488"/><a data-type="indexterm" data-primary="string.h" data-startref="string-library" id="idm45018721123272"/><a data-type="indexterm" data-primary="strings" data-secondary="string.h" data-startref="strings-string" id="idm45018721122328"/>users.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="math.h"><div class="sect2" id="smallerc-CHP-7-SECT-1.4">
<h2>math.h</h2>

<p>The <em>math.h</em> header<a data-type="indexterm" data-primary="libraries" data-secondary="C standard library" data-tertiary="math.h" id="libraries-c-math"/><a data-type="indexterm" data-primary="C standard library" data-secondary="math.h" id="c-library-math"/><a data-type="indexterm" data-primary="math.h" id="math-library"/> declares several useful functions for performing a variety
of arithmetic and trigonometric calculations. <a data-type="xref" href="#smallerc-CHP-7-TABLE-math-lib">Table 7-2</a>
includes several of the more popular functions. All of these <a data-type="indexterm" data-primary="functions" data-secondary="for calculations" data-secondary-sortas="calculations" id="functions-calculate"/><a data-type="indexterm" data-primary="cos() function" id="idm45018721107704"/><a data-type="indexterm" data-primary="sin() function" id="idm45018721107032"/><a data-type="indexterm" data-primary="atan() function" id="idm45018721106360"/><a data-type="indexterm" data-primary="atan2() function" id="idm45018721105688"/><a data-type="indexterm" data-primary="exp() function" id="idm45018721105016"/><a data-type="indexterm" data-primary="log() function" id="idm45018721085784"/><a data-type="indexterm" data-primary="log10() function" id="idm45018721085176"/><a data-type="indexterm" data-primary="pow() function" id="idm45018721084568"/><a data-type="indexterm" data-primary="sqrt() function" id="idm45018721083928"/>functions return
a <code>double</code> value.</p>
<table id="smallerc-CHP-7-TABLE-math-lib">
<caption><span class="label">Table 7-2. </span>Handy functions from <em>math.h</em></caption>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td colspan="2"><p>Trigonometric Functions</p></td>
</tr>
<tr>
<td><p><code>cos(double rad)</code></p></td>
<td><p>Cosine</p></td>
</tr>
<tr>
<td><p><code>sin(double rad)</code></p></td>
<td><p>Sine</p></td>
</tr>
<tr>
<td><p><code>atan(double rad)</code></p></td>
<td><p>Arctangent</p></td>
</tr>
<tr>
<td><p><code>atan2(double y, double x)</code></p></td>
<td><p>Two-argument arctangent (angle between positive X axis and point (x,y))</p></td>
</tr>
<tr>
<td colspan="2"><p>Roots and Exponents</p></td>
</tr>
<tr>
<td><p><code>exp(double x)</code></p></td>
<td><p><em>e</em><sup>x</sup></p></td>
</tr>
<tr>
<td><p><code>log(double x)</code></p></td>
<td><p>Natural logarithm (base <em>e</em>) of x</p></td>
</tr>
<tr>
<td><p><code>log10(double x)</code></p></td>
<td><p>Common logarithm (base 10) of x</p></td>
</tr>
<tr>
<td><p><code>pow(double x, double y)</code></p></td>
<td><p>x<sup>y</sup></p></td>
</tr>
<tr>
<td><p><code>sqrt(double x)</code></p></td>
<td><p>Square root of x</p></td>
</tr>
<tr class="pagebreak-before">
<td colspan="2"><p>Rounding</p></td>
</tr>
<tr>
<td><p><code>ceil(double x)</code></p></td>
<td><p>Ceiling function, next bigger integer from x</p></td>
</tr>
<tr>
<td><p><code>floor(double x)</code></p></td>
<td><p>Floor function, next smaller integer from x</p></td>
</tr>
<tr>
<td colspan="2"><p>Signs</p></td>
</tr>
<tr>
<td><p><code>fabs(double x)</code><sup><a data-type="noteref" epub:type="noteref" id="idm45541405640408-marker" href="#idm45541405640408">a</a></sup></p></td>
<td><p>Return the absolute value of x</p></td>
</tr>
</tbody>
<tbody><tr class="footnotes"><td colspan="2"><p data-type="footnote" epub:type="footnote" id="idm45541405640408"><sup><a href="#idm45541405640408-marker">a</a></sup> Oddly, the absolute value function for integer types, <code>abs()</code>, is declared in <em>stdlib.h</em>.</p></td></tr></tbody></table>

<p>For any situation where<a data-type="indexterm" data-primary="ceil() function" id="idm45018721046808"/><a data-type="indexterm" data-primary="floor() function" id="idm45018721046168"/><a data-type="indexterm" data-primary="fabs() function" id="idm45018721045496"/><a data-type="indexterm" data-primary="functions" data-secondary="for calculations" data-secondary-sortas="calculations" data-startref="functions-calculate" id="idm45018721044824"/> you want an <code>int</code> or <code>long</code> answer, you just have to cast. For example,
we could write a simple program
(<a href="https://oreil.ly/rEMTv"><em>ch07/rounding.c</em></a>)
to average several integers and then round them to the nearest
<code>int</code> value like this:</p>

<pre data-type="programlisting" data-code-language="c"><code class="cp">#include &lt;stdio.h&gt;</code>
<code class="cp">#include &lt;math.h&gt;</code>

<code class="kt">int</code> <code class="nf">main</code><code class="p">()</code> <code class="p">{</code>
  <code class="kt">int</code> <code class="n">grades</code><code class="p">[</code><code class="mi">6</code><code class="p">]</code> <code class="o">=</code> <code class="p">{</code> <code class="mi">86</code><code class="p">,</code> <code class="mi">97</code><code class="p">,</code> <code class="mi">77</code><code class="p">,</code> <code class="mi">76</code><code class="p">,</code> <code class="mi">85</code><code class="p">,</code> <code class="mi">90</code> <code class="p">};</code>
  <code class="kt">int</code> <code class="n">total</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>
  <code class="kt">int</code> <code class="n">average</code><code class="p">;</code>

  <code class="k">for</code> <code class="p">(</code><code class="kt">int</code> <code class="n">g</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="n">g</code> <code class="o">&lt;</code> <code class="mi">6</code><code class="p">;</code> <code class="n">g</code><code class="o">++</code><code class="p">)</code> <code class="p">{</code>
    <code class="n">total</code> <code class="o">+=</code> <code class="n">grades</code><code class="p">[</code><code class="n">g</code><code class="p">];</code>
  <code class="p">}</code>
  <code class="n">printf</code><code class="p">(</code><code class="s">"Raw average: %0.2f</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code> <code class="n">total</code> <code class="o">/</code> <code class="mf">6.0</code><code class="p">);</code>
  <code class="n">average</code> <code class="o">=</code> <code class="p">(</code><code class="kt">int</code><code class="p">)</code><code class="n">floor</code><code class="p">(</code><code class="n">total</code> <code class="o">/</code> <code class="mf">6.0</code> <code class="o">+</code> <code class="mf">0.5</code><code class="p">);</code>
  <code class="n">printf</code><code class="p">(</code><code class="s">"Rounded average: %d</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code> <code class="n">average</code><code class="p">);</code>
<code class="p">}</code></pre>

<p>Since we (may) need to help the compiler with this library, let’s take a look at the
compile command:</p>

<pre data-type="programlisting">gcc rounding.c -lm</pre>

<p>Again, <em>math.h</em> declares functions in the C standard library, but those functions are not
necessarily implemented in the same place as other functions. The binary containing most
of the functions we’re discussing is <em>libc</em> (or <em>glibc</em> for GNU’s version).
However, on many systems, the math functions live in a separate binary, <em>libm</em>, which
requires that trailing <strong><code>-lm</code></strong> flag to make sure the compiler knows to link in the math library.</p>

<p>Your system may differ. There’s no harm in trying to compile without the <strong><code>-lm</code></strong>
option to see if your system automatically includes <em>libm</em> (or has all of the functions
already included in <em>libc</em>). If you try compiling without the flag and you don’t get
any errors, you’re in good shape! If you do need the library flag, you’ll see
something like this:</p>

<pre data-type="programlisting" class="pagebreak-before less_space">ch07$ gcc rounding.c
/usr/bin/ld: /tmp/ccP1MUC7.o: in function `main':
rounding.c:(.text+0xaf): undefined reference to `floor'
collect2: error: ld returned 1 exit status</pre>

<p>Try it yourself (with or without the library flag as needed).
You should get 85 as an answer. If rounding is something you do often, you
can write your own function to simplify things and avoid littering your code with the slightly
clunky business of adding the 0.5 value before calling <code>floor()</code> and casting the <a data-type="indexterm" data-primary="libraries" data-secondary="C standard library" data-tertiary="math.h" data-startref="libraries-c-math" id="idm45018720939496"/><a data-type="indexterm" data-primary="C standard library" data-secondary="math.h" data-startref="c-library-math" id="idm45018720937944"/><a data-type="indexterm" data-primary="math.h" data-startref="math-library" id="idm45018720936728"/>result.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="time.h"><div class="sect2" id="smallerc-CHP-7-SECT-1.5">
<h2>time.h</h2>

<p>This<a data-type="indexterm" data-primary="libraries" data-secondary="C standard library" data-tertiary="time.h" id="libraries-c-time"/><a data-type="indexterm" data-primary="C standard library" data-secondary="time.h" id="c-library-time"/><a data-type="indexterm" data-primary="time.h" id="time-library"/> header gives you access to a number of utilities to help with determining and
displaying time. It uses two types of storage for handling dates and times: a simple
timestamp (with a type alias, <code>time_t</code>, representing the number of seconds since
January 1, 1970, UTC) and a much more detailed structure, <code>struct tm</code>, with the
following definition:</p>

<pre data-type="programlisting" data-code-language="c"><code class="k">struct</code> <code class="n">tm</code> <code class="p">{</code>
  <code class="kt">int</code> <code class="n">tm_sec</code><code class="p">;</code>   <code class="c1">// seconds (0 - 60; allow for leap second)</code>
  <code class="kt">int</code> <code class="n">tm_min</code><code class="p">;</code>   <code class="c1">// minutes (0 - 59)</code>
  <code class="kt">int</code> <code class="n">tm_hour</code><code class="p">;</code>  <code class="c1">// hours (0 - 23)</code>
  <code class="kt">int</code> <code class="n">tm_mday</code><code class="p">;</code>  <code class="c1">// day of month (1 - 31)</code>
  <code class="kt">int</code> <code class="n">tm_mon</code><code class="p">;</code>   <code class="c1">// month (0 - 11; WARNING! NOT 1 - 12)</code>
  <code class="kt">int</code> <code class="n">tm_year</code><code class="p">;</code>  <code class="c1">// year (since 1900)</code>
  <code class="kt">int</code> <code class="n">tm_wday</code><code class="p">;</code>  <code class="c1">// day of week (0 - 6)</code>
  <code class="kt">int</code> <code class="n">tm_yday</code><code class="p">;</code>  <code class="c1">// day of year (0 - 365)</code>
  <code class="kt">int</code> <code class="n">tm_isdst</code><code class="p">;</code> <code class="c1">// Daylight Saving Time flag</code>
                <code class="c1">// This flag can be in one of three states:</code>
                <code class="c1">// -1 == unavailable, 0 == standard time, 1 == DST.</code>
<code class="p">}</code></pre>

<p>I won’t be using this nifty structure with all the separated fields, but it
can be useful if you are doing any work with dates and times, like you might find in a
calendaring application. I will be using timestamps from, uh, time to time, as we’ve
already seen in <a data-type="xref" href="#smallerc-CHP-7-SECT-1.2.2">“rand() and srand()”</a> for supplying a changing seed to the <code>srand()</code> function.
<a data-type="xref" href="#smallerc-CHP-7-TABLE-time-lib">Table 7-3</a> shows some functions that<a data-type="indexterm" data-primary="timestamps, functions for" id="idm45018720882184"/><a data-type="indexterm" data-primary="functions" data-secondary="for time" data-secondary-sortas="time" id="functions-time"/><a data-type="indexterm" data-primary="ctime() function" id="idm45018720879960"/><a data-type="indexterm" data-primary="localtime() function" id="idm45018720879288"/><a data-type="indexterm" data-primary="mktime() function" id="idm45018720878616"/><a data-type="indexterm" data-primary="time() function" id="idm45018720877944"/> work with these simple values:</p>
<table id="smallerc-CHP-7-TABLE-time-lib">
<caption><span class="label">Table 7-3. </span>Working with timestamps</caption>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>char *ctime(time_t *t)</code></p></td>
<td><p>Return a string of the local time</p></td>
</tr>
<tr>
<td><p><code>struct tm *localtime(time_t *t)</code></p></td>
<td><p>Expand a timestamp into the detailed structure</p></td>
</tr>
<tr>
<td><p><code>time_t mktime(struct tm *t)</code></p></td>
<td><p>Reduce a structure to a timestamp</p></td>
</tr>
<tr>
<td><p><code>time_t time(time_t *t)</code></p></td>
<td><p>Return the current time as a timestamp</p></td>
</tr>
</tbody>
</table>

<p>The definition of that last function, <code>time()</code>, might look a little weird. It
both takes and returns a <code>time_t</code> pointer. You can call <code>time()</code> with either a
<code>NULL</code> value or with a valid pointer to a variable of type <code>time_t</code>. If you use
<code>NULL</code>, the current time is simply returned. If you supply a pointer, the current time is returned, but the variable pointed to is also updated with the current time. We only need the <code>NULL</code> option for our work with random numbers, but you’ll stumble on a few utility functions that use this pattern. It can be useful if you are working with heap <a data-type="indexterm" data-primary="libraries" data-secondary="C standard library" data-tertiary="time.h" data-startref="libraries-c-time" id="idm45018720814776"/><a data-type="indexterm" data-primary="C standard library" data-secondary="time.h" data-startref="c-library-time" id="idm45018720813256"/><a data-type="indexterm" data-primary="time.h" data-startref="time-library" id="idm45018720812040"/>memory.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="ctype.h"><div class="sect2" id="smallerc-CHP-7-SECT-1.6">
<h2>ctype.h</h2>

<p>Many<a data-type="indexterm" data-primary="libraries" data-secondary="C standard library" data-tertiary="ctype.h" id="idm45018720809128"/><a data-type="indexterm" data-primary="C standard library" data-secondary="ctype.h" id="idm45018720807464"/><a data-type="indexterm" data-primary="ctype.h" id="idm45018720806520"/><a data-type="indexterm" data-primary="characters" data-secondary="ctype.h" id="idm45018720805848"/><a data-type="indexterm" data-primary="functions" data-secondary="for characters" data-secondary-sortas="characters" id="idm45018720804904"/> situations where you process input from users require you to validate that
the input conforms to some expected type or value. For example, a ZIP code should
be five digits and a US state abbreviation should be two uppercase letters.
The <em>ctype.h</em> header declares several handy functions for checking individual characters.
It also has two helper functions that convert between upper- and lowercase.
<a data-type="xref" href="#smallerc-CHP-7-TABLE-ctype-lib">Table 7-4</a> highlights several <a data-type="indexterm" data-primary="isalnum() function" id="idm45018720801944"/><a data-type="indexterm" data-primary="isalpha() function" id="idm45018720801240"/><a data-type="indexterm" data-primary="isdigit() function" id="idm45018720800568"/><a data-type="indexterm" data-primary="isxdigit() function" id="idm45018720799896"/><a data-type="indexterm" data-primary="islower() function" id="idm45018720799224"/><a data-type="indexterm" data-primary="isupper() function" id="idm45018720798552"/><a data-type="indexterm" data-primary="isspace() function" id="idm45018720797880"/><a data-type="indexterm" data-primary="tolower() function" id="idm45018720797208"/><a data-type="indexterm" data-primary="toupper() function" id="idm45018720796536"/>of these functions.</p>
<table id="smallerc-CHP-7-TABLE-ctype-lib">
<caption><span class="label">Table 7-4. </span>Working with characters using <em>ctype.h</em></caption>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td colspan="2"><p>Testing</p></td>
</tr>
<tr>
<td><p><code>isalnum(int c)</code></p></td>
<td><p>Is <code>c</code> a numeric character or a letter</p></td>
</tr>
<tr>
<td><p><code>isalpha(int c)</code></p></td>
<td><p>Is <code>c</code> a letter</p></td>
</tr>
<tr>
<td><p><code>isdigit(int c)</code></p></td>
<td><p>Is <code>c</code> a decimal digit</p></td>
</tr>
<tr>
<td><p><code>isxdigit(int c)</code></p></td>
<td><p>Is <code>c</code> a hexadecimal digit (case-insensitive)</p></td>
</tr>
<tr>
<td><p><code>islower(int c)</code></p></td>
<td><p>Is <code>c</code> a lowercase letter</p></td>
</tr>
<tr>
<td><p><code>isupper(int c)</code></p></td>
<td><p>Is <code>c</code> an uppercase letter</p></td>
</tr>
<tr>
<td><p><code>isspace(int c)</code></p></td>
<td><p>Is <code>c</code> a space, tab, newline, carriage return, vertical tab, or form feed</p></td>
</tr>
<tr>
<td colspan="2"><p>Conversion</p></td>
</tr>
<tr>
<td><p><code>tolower(int c)</code></p></td>
<td><p>Return the lowercase version of <code>c</code></p></td>
</tr>
<tr>
<td><p><code>toupper(int c)</code></p></td>
<td><p>Return the uppercase version of <code>c</code></p></td>
</tr>
</tbody>
</table>

<p>Don’t forget your Boolean operators! You can easily expand these tests
to ask questions like “is not whitespace” with the <code>!</code> operator:</p>

<pre data-type="programlisting" data-code-language="c">  <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="n">isspace</code><code class="p">(</code><code class="n">answer</code><code class="p">))</code> <code class="p">{</code>
    <code class="c1">// Not a blank character, so go ahead</code>
    <code class="p">...</code>
  <code class="p">}</code></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>As with the math functions and getting a <code>double</code> result where you need an <code>int</code>,
the conversion functions in <em>ctype.h</em> return an <code>int</code>, but you can easily cast it
to a <code>char</code> as needed.</p>
</div>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Putting It Together"><div class="sect1" id="smallerc-CHP-7-SECT-2">
<h1>Putting It Together</h1>

<p>Let’s pull in a few of these new headers and use some of the topics from
previous chapters to make a more rounded example. We’ll create a structure
to store information on a simple bank account.
We can use the new <em>string.h</em> utilities to add a name field to
each account. And we’ll use the <em>math.h</em> functions to calculate a sample
compound interest payment on the balance of the account. Here are the includes
this example will require:</p>

<pre data-type="programlisting" data-code-language="c"><code class="cp">#include &lt;stdio.h&gt;</code>
<code class="cp">#include &lt;stdlib.h&gt;</code>
<code class="cp">#include &lt;string.h&gt;</code>
<code class="cp">#include &lt;math.h&gt;</code></pre>

<p>With our headers ready, let’s dive in and get the program itself going.</p>








<section data-type="sect2" data-pdf-bookmark="Filling In Strings"><div class="sect2" id="smallerc-CHP-7-SECT-2.1">
<h2>Filling In Strings</h2>

<p>Let’s <a data-type="indexterm" data-primary="strings" data-secondary="in structures" data-secondary-sortas="structures" id="string-structures"/><a data-type="indexterm" data-primary="structures" data-secondary="strings in" id="structures-strings"/><a data-type="indexterm" data-primary="strncpy() function" id="strncpy"/>start our example by creating our account type including a
string “name” field. The new <code>struct</code> is simple enough:</p>

<pre data-type="programlisting" data-code-language="c"><code class="k">struct</code> <code class="n">account</code> <code class="p">{</code>
  <code class="kt">char</code> <code class="n">name</code><code class="p">[</code><code class="mi">50</code><code class="p">];</code>
  <code class="kt">double</code> <code class="n">balance</code><code class="p">;</code>
<code class="p">};</code></pre>

<p>We can now use our
string functions to load up <code>name</code> with actual content after our structure is created.
We can also use <code>malloc()</code> to create that structure in a function and return the address
of our account. Here’s the new function, with some of the safety
checks omitted just for readability:</p>

<pre data-type="programlisting" data-code-language="c"><code class="k">struct</code> <code class="n">account</code> <code class="o">*</code><code class="nf">create</code><code class="p">(</code><code class="kt">char</code> <code class="o">*</code><code class="n">name</code><code class="p">,</code> <code class="kt">double</code> <code class="n">initial</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">struct</code> <code class="n">account</code> <code class="o">*</code><code class="n">acct</code> <code class="o">=</code> <code class="n">malloc</code><code class="p">(</code><code class="k">sizeof</code><code class="p">(</code><code class="k">struct</code> <code class="n">account</code><code class="p">));</code>
  <code class="n">strncpy</code><code class="p">(</code><code class="n">acct</code><code class="o">-&gt;</code><code class="n">name</code><code class="p">,</code> <code class="n">name</code><code class="p">,</code> <code class="mi">49</code><code class="p">);</code>
  <code class="n">acct</code><code class="o">-&gt;</code><code class="n">balance</code> <code class="o">=</code> <code class="n">initial</code><code class="p">;</code>
  <code class="k">return</code> <code class="n">acct</code><code class="p">;</code>
<code class="p">}</code></pre>

<p>Notice I chose to use <code>strncpy()</code> here. The idea is that I cannot guarantee
the incoming <code>name</code> parameter will fit. Since I wrote the entire program,
of course, I certainly can guarantee that detail, but that’s not the
point. I want to make sure if I ever allow user input, say,
by prompting the user for details, my <code>create()</code> function has some
safeguards in place.</p>

<p>Let’s go ahead and create a function to print our account
details. Hopefully, this code looks familiar from our work in <a data-type="xref" href="ch06.xhtml#smallerc-CHP-6">Chapter 6</a>. We can also start our <code>main()</code> function to try out everything we’ve written so far:</p>

<pre data-type="programlisting" data-code-language="c"><code class="kt">void</code> <code class="nf">print</code><code class="p">(</code><code class="k">struct</code> <code class="n">account</code> <code class="o">*</code><code class="n">a</code><code class="p">)</code> <code class="p">{</code>
  <code class="n">printf</code><code class="p">(</code><code class="s">"Account: %s</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code> <code class="n">a</code><code class="o">-&gt;</code><code class="n">name</code><code class="p">);</code>
  <code class="n">printf</code><code class="p">(</code><code class="s">"Balance: $%.2f</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code> <code class="n">a</code><code class="o">-&gt;</code><code class="n">balance</code><code class="p">);</code>
<code class="p">}</code>

<code class="kt">int</code> <code class="nf">main</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">struct</code> <code class="n">account</code> <code class="o">*</code><code class="n">checking</code><code class="p">;</code>
  <code class="n">checking</code> <code class="o">=</code> <code class="n">create</code><code class="p">(</code><code class="s">"Bank of Earth (checking)"</code><code class="p">,</code> <code class="mf">200.0</code><code class="p">);</code>
  <code class="n">print</code><code class="p">(</code><code class="n">checking</code><code class="p">);</code>
  <code class="n">free</code><code class="p">(</code><code class="n">checking</code><code class="p">);</code>
<code class="p">}</code></pre>

<p>Let’s compile and run
<a href="https://oreil.ly/i8vvr"><em>ch07/account1.c</em></a>.
Here’s our output:</p>

<pre data-type="programlisting">ch07$ gcc account1.c
ch07$ ./a.out
Account: Bank of Earth (checking)
Balance: $200.00</pre>

<p>Hooray! So far, <a data-type="indexterm" data-primary="strings" data-secondary="in structures" data-secondary-sortas="structures" data-startref="string-structures" id="idm45018720504216"/><a data-type="indexterm" data-primary="structures" data-secondary="strings in" data-startref="structures-strings" id="idm45018720502664"/><a data-type="indexterm" data-primary="strncpy() function" data-startref="strncpy" id="idm45018720501448"/>so good. Next up is figuring out an interest payment.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Finding Our Interest"><div class="sect2" id="smallerc-CHP-7-SECT-2.2">
<h2>Finding Our Interest</h2>

<p>Using<a data-type="indexterm" data-primary="pow() function" id="pow-function"/><a data-type="indexterm" data-primary="interest calculations" id="interest-calculate"/> the <code>pow()</code> function from the <em>math.h</em> library, we can calculate a monthly
compounded interest in one expression. I know I was taught this formula in high school,
but I still have to look it up online any time I actually need to use it.
Then we’ll update <code>main()</code> to add a year’s worth of interest (at 5%)
to our account and print out the details again. Here are the new parts from
<a href="https://oreil.ly/EAOwS"><em>ch07/account2.c</em></a>:</p>

<pre data-type="programlisting" data-code-language="c"><code class="kt">void</code> <code class="nf">add_interest</code><code class="p">(</code><code class="k">struct</code> <code class="n">account</code> <code class="o">*</code><code class="n">acct</code><code class="p">,</code> <code class="kt">double</code> <code class="n">rate</code><code class="p">,</code> <code class="kt">int</code> <code class="n">months</code><code class="p">)</code> <code class="p">{</code>
  <code class="c1">// Put our current balance in a local var for easier use</code>
  <code class="kt">double</code> <code class="n">principal</code> <code class="o">=</code> <code class="n">acct</code><code class="o">-&gt;</code><code class="n">balance</code><code class="p">;</code>
  <code class="c1">// Convert our annual rate to a monthly percentage value</code>
  <code class="n">rate</code> <code class="o">/=</code> <code class="mi">1200</code><code class="p">;</code>
  <code class="c1">// Use the interest formula to calculate our new balance</code>
  <code class="n">acct</code><code class="o">-&gt;</code><code class="n">balance</code> <code class="o">=</code> <code class="n">principal</code> <code class="o">*</code> <code class="n">pow</code><code class="p">(</code><code class="mi">1</code> <code class="o">+</code> <code class="n">rate</code><code class="p">,</code> <code class="n">months</code><code class="p">);</code>
<code class="p">}</code>

<code class="kt">int</code> <code class="nf">main</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">struct</code> <code class="n">account</code> <code class="o">*</code><code class="n">checking</code><code class="p">;</code>
  <code class="n">checking</code> <code class="o">=</code> <code class="n">create</code><code class="p">(</code><code class="s">"Bank of Earth (checking)"</code><code class="p">,</code> <code class="mf">200.0</code><code class="p">);</code>
  <code class="n">print</code><code class="p">(</code><code class="n">checking</code><code class="p">);</code>

  <code class="n">add_interest</code><code class="p">(</code><code class="n">checking</code><code class="p">,</code> <code class="mf">5.0</code><code class="p">,</code> <code class="mi">12</code><code class="p">);</code>
  <code class="n">print</code><code class="p">(</code><code class="n">checking</code><code class="p">);</code>

  <code class="n">free</code><code class="p">(</code><code class="n">checking</code><code class="p">);</code>
<code class="p">}</code></pre>

<p>That’s looking pretty good! Let’s compile and run <em>account2.c</em>. If
your system needs the <strong><code>-lm</code></strong> math library flag, be sure to add it when you
compile:</p>

<pre data-type="programlisting">ch07$ gcc account2.c -lm
ch07$ ./a.out
Account: Bank of Earth (checking)
Balance: $200.00
Account: Bank of Earth (checking)
Balance: $210.23</pre>

<p>Everything worked! Although you are reading the final output from my code
 <em>after</em> I fixed the various little mistakes I made while
writing it. I reversed the order of the source and destination strings in <code>strncpy()</code>,
for example. It’s rare to get everything right
the first time. The compiler will usually let you know what you got wrong. You just
head back to your editor and fix it. Getting comfortable with mistakes—and
with fixing them!—is one of the reasons I encourage you to type in
some of these examples. Nothing like actually writing code to <a data-type="indexterm" data-primary="pow() function" data-startref="pow-function" id="idm45018720366280"/><a data-type="indexterm" data-primary="interest calculations" data-startref="interest-calculate" id="idm45018720365304"/>get better at
writing code.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Finding New Libraries"><div class="sect1" id="smallerc-CHP-7-SECT-3">
<h1>Finding New Libraries</h1>

<p>There are <a data-type="indexterm" data-primary="libraries" data-secondary="finding" id="libraries-finding"/><a data-type="indexterm" data-primary="finding libraries" id="finding-libraries"/>many more libraries out there for your consumption than I can possibly
cover here. Indeed, there are more functions just in the C standard library;
you can dig much deeper with the
<a href="https://oreil.ly/58fLM">GNU C Library</a>
documentation online.</p>

<p>Beyond the standard library, though, there are other libraries that can help
with your projects. For those situations where you want a specialized library,
your best bet these days is to search online. If you want to interact directly
with a USB-connected device, for example, you could search for “C USB
library” and wind up with the nifty <em>libusb</em> from <a href="https://libusb.info"><em class="hyperlink">https://libusb.info</em></a>.</p>

<p>You can also find some lists of popular libraries, but those lists vary in
quality and upkeep. Sadly, there is no central repository for “all things C”
like one has with some languages. My advice is to look over the search results for
links to reputable sites like <a href="https://github.com">GitHub</a> or
<a href="https://gnu.org">gnu.org</a>. And don’t be afraid
to just read through the source code of the library. If anything you see raises a flag,
pay attention. Most times you’ll be getting exactly what you expected, but a little
caution is always advisable when using things you find online.</p>
<aside data-type="sidebar" epub:type="sidebar" class="pagebreak-before less_space"><div class="sidebar" id="smallerc-CHP-7-SECT-3.1">
<h5>Coming to a Folder Near You</h5>
<p>I also<a data-type="indexterm" data-primary="libraries" data-secondary="folder locations" id="libraries-folders"/><a data-type="indexterm" data-primary="folders for libraries" id="folders-libraries"/> want to point out that most development environments have several of the more
common libraries ready for use by you and other applications installed on
your system right out of the gate. Where the header files for these libraries
get stored varies from system to system, but Linux <a data-type="indexterm" data-primary="Linux" data-secondary="library folders" id="idm45018720349560"/>systems
have the <em>/usr/include</em> and <em>/usr/local/include</em> folders as popular locations.</p>

<p>On macOS, you<a data-type="indexterm" data-primary="macOS" data-secondary="library folders" id="idm45018720347208"/> can find many headers in <em>/usr/local/include</em> but most will be in an
ungainly path below your Xcode application, such as
<em>/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include</em>.</p>

<p>On Windows, it <a data-type="indexterm" data-primary="Windows" data-secondary="library folders" id="idm45018720344504"/>depends largely on how you installed GCC, but you will often find similar <em>usr\include</em> or <em>usr\local\include</em> folders under the install folder for your compiler. For example, on my Windows 10 machine, I can use a normal <em>cmd.exe</em> window and navigate to <em>C:\msys64\usr\include</em>. On a different machine with Cygwin, that<a data-type="indexterm" data-primary="libraries" data-secondary="finding" data-startref="libraries-finding" id="idm45018720341576"/><a data-type="indexterm" data-primary="finding libraries" data-startref="finding-libraries" id="idm45018720340328"/> folder is <em>C:\cygwin65\lib\gcc\x86_64-pc-cygwin\10\include</em>.</p>
</div></aside>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Next Steps"><div class="sect1" id="smallerc-CHP-7-SECT-4">
<h1>Next Steps</h1>

<p>Helping you get better at writing code is certainly one of the goals for this
book. We’ve covered a number of the more common and popular libraries
(and the header files that we must include to make use of their
functions) in this chapter. There are certainly more libraries out there!
Hopefully, you see how libraries and headers interact with your own code.</p>

<p>We’ll be tackling microcontrollers next, and we’ll start looking
at writing <em>tighter</em> code along the way. Good code isn’t necessarily a
prerequisite for doing optimization work, but it sure helps. Feel free to
review some of the examples from past chapters before forging ahead. Try making
some changes. Try breaking things. Try fixing the things you broke. Every
successful compile should count as a notch in your programmer belt.</p>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm45018721966312"><sup><a href="ch07.xhtml#idm45018721966312-marker">1</a></sup> That algorithm is deterministic and while that’s fine for most developers, it is not truly random.</p><p data-type="footnote" id="idm45018721851352"><sup><a href="ch07.xhtml#idm45018721851352-marker">2</a></sup> I don’t have space to cover good generators, but searching online for “C random generator” will net you some interesting options. There are better algorithms such as Blum Blum Shub or a Mersenne Twister, but you can also find hardware-dependent generators that are better still.</p></div></div></section></div></body></html>