# 前置内容

## 前言

C++是一种不断改进的语言，几乎被用于计算领域的每个角落，从嵌入式系统、操作系统、浏览器、游戏和交易系统到你们可能用来阅读这本书的电子书阅读器。每三年就会推出一个新的 C++标准，编译器供应商也迅速采用最新的功能。我已经在看似不同的游戏和金融行业中专业编写 C++超过 20 年。我主要担心我的代码性能，这导致我创建了 Compiler Explorer，而不是关注语言中的每一个小变化。

同时，在我心中，我担心我可能遗漏了某些东西。当我听说 Fran 正在写这本书时，我很兴奋有机会赶上我长期以来一直忽视的语言的新部分。

我第一次在 C++ on Sea 会议上见到 Fran。她负责主持闪电演讲——每位演讲者有 5 分钟的时间进行演讲，一个接一个地快速进行。作为演讲的主持人，Fran 必须在一个人上台而前一个人离开时进行过渡，在这个过程中，她邀请观众参与各种猜测游戏，比如高或低牌游戏或砸谜题游戏，让我们猜测各种与 C++关键字混合的会议演讲者名字。我们当时并不知道她正在尝试一些她在本书中用作例子的游戏！

在这本书中，Fran 涵盖了包括智能指针、范围、可选类型、变体类型、改进的字符串格式化、constexpr、概念和协程在内的许多最新的 C++特性。如果你对其中任何一个不熟悉，那么你将有一个美好的体验。正如我提到的，我并不总是跟上最新的特性，阅读这本书是一种很有趣的获取它们的方式。而且我终于学会了聚合初始化器和初始化列表之间的区别！

语言的持续进化意味着今天的 C++不再是你们可能从 20 世纪 90 年代和 21 世纪初期记忆中的 bug-prone tangle of memory leaks。不幸的是，在线资源缓慢跟进，并且经常展示旧的、已弃用的做事方式。本书澄清了许多误解，并将为你指明正确的道路。

例子既有趣又好玩，但展示了真实世界的非平凡代码。每个部分都展示了开发过程，随着 Fran 逐一介绍新概念，代码也在迭代。我鼓励你在阅读每个部分时参与进来，编译并运行代码。至少对我来说，通过实践学习比仅仅阅读更有效，通过修改代码，你可以更好地了解修改的容易程度。

在这个过程中，有许多关于我们在编写代码时必须做出的权衡的通用发展建议。有一些测试探索了边缘情况及其处理方法，甚至有如何编写如果使用不当则无法编译的代码的例子，以及有用的错误信息。

每个部分都有相关的链接到在线资源，如博客文章、参考网站和在线工具（不仅仅是编译器探索器），这些资源可以帮助您更深入地理解问题。这些链接完美地补充了书籍，不会分散示例的流程，但如果你愿意，你可以进一步探索。

通过实例学习 C++是一种有趣且实用的方式，可以学习 C++的最新特性。如果您像我一样，一直在担心自己错过了什么，或者如果您在一段时间后重返 C++，那么让弗兰带您踏上现代 C++可能性的旅程，并学习如何用代码走出困境吧！

—马特·戈德博尔特

## 前言

我第一次接触 C++是在 20 世纪 90 年代，当时被要求编写一个 C++解析器来模拟在 PC 上为嵌入式设备编写的代码。当时我只知道 C 语言，所以这对我来说是一次火与血的洗礼。C++主要是 C 语言加上类，就像许多早期的 C++版本一样。随着时间的推移，我学到了更多，并爱上了这门语言。作为 ACCU（[`accu.org/`](https://accu.org/)）的长期成员，我自愿担任其《Overload》杂志的编辑，这意味着我必须每隔一个月写一篇社论，并鼓励人们投稿以及收集审稿团队的反馈。《Overload》杂志的文章涵盖了从新手到资深专业人士的各种内容，深入探讨了 C++，以及更广泛的编程主题，因此作为编辑，我需要努力跟上所有这些内容。这是一个挑战，我还有很多东西要学。

我曾用 C++进行个人项目，你可以在 YouTube 上找到我许多演讲。我也在专业上使用 C++，主要是在投资银行和其他金融机构。我还了解其他语言，经常在编写 C++库的量化团队和使用它们的前端团队之间充当中间人。我确实理解火箭科学家在编码中使用的许多底层数学。说实话，我只和两位火箭科学家一起工作过，但你可以用 C++做聪明的事情。重要的是理解你在做什么，以及如何测试你的代码。

C++是一门不断发展的语言，所以我永远无法跟上所有的变化。然而，意识到自己不知道的东西意味着我可以挑选特定的部分来练习。在这本书中，我分享了各种小型项目，旨在帮助您学习各种新的 C++特性。多年来，我遇到了许多曾经了解 C++但后来转向使用其他语言一段时间的人，当他们考虑再次学习 C++时，他们被新特性和方法的数量所压倒。花时间学习某样东西，然后发现很难重新熟悉它，这是令人沮丧的。我想鼓励任何处于这种情况的人专注于关键元素，以快速恢复。我希望这本书能满足这一需求。

这本书并没有涵盖从 C++11 以来所有变化的内容。在我撰写这本书的时候，C++23 已经最终确定，所以我包括了当时写作时的一些最新特性。C++ 将会继续变化，但拥有几个可以玩耍的小项目意味着你可以随着语言的不断发展而练习使用它们。例如，这本书使用了各种容器，从 `std::vector` 到 `std::unordered_map`，等等。容器一直是 C++ 的基本组成部分，但最近的变化使得它们更容易使用。这本书使用了各种新特性，而没有试图成为整个语言的参考书。关于本书的部分提供了更多详细信息。

## 致谢

撰写这本书既有趣又具有挑战性。我在尝试解释 C++ 的各个方面时学到了很多。我经常向他人寻求帮助或想法，同时努力找到简单但正确描述语言的方法。感谢所有与我争论以确保我正确的人。

我想感谢 Matt Godbolt 为我撰写前言。我很高兴你享受阅读这本书。

在 Manning，我想感谢我的开发编辑 Doug Rudder 和我的 *技术编辑* Tim van Deurzen 在撰写本书时的反馈、帮助和鼓励。此外，感谢帮助制作本书的全体工作人员。

我还想感谢所有花时间给我反馈的人，特别是 Howard Hinnant、Andreas Fertig、Nina Ranns、Silas Brown 和 Seb Rose，他们都从繁忙的日程中抽出时间对各个章节进行详细评论，指出我不清楚或不正确的地方。我也感谢 ACCU 和那些在一般电子邮件组中解释我写作时发现的有趣边缘情况的人。任何剩余的错误都是我自己的。

我感谢所有参与 C++ 的人，包括 Matt Godbolt 为他的编译器探索器，Andreas Fertig 为 C++ Insights，以及所有投入时间和金钱开发新标准或参与各种讨论小组的人。

最后，感谢所有审稿人：Amit Lamba、Arun Saha、Aryan Maurya、Balbir Singh、Clifford Thurber、David Racey、Frédéric Flayol、Jean-François Morin、Johannes Lochmann、John Donoghue、Jonathan R. Choate、Jonathan Reeves、Joseph Perenia、Juan José Durillo Barrionuevo、Keith Kim、Kent Spillner、Matteo Battista、Mattia Antonino Di Gangi、Maurizio Tomasi、Michael Kolesidis、Mitchell Fox、Partha Pratim Mukherjee、Patrick Regan、Raushan Jha、Rich Yonts、Samson Hailu、Satej Kumar Sahu、Srikar Vedantam、Sriram Macharla、Timothy Moore、Vimal Upadhyay 和 William Walsh。你们的建议帮助使这本书变得更好。

## 关于本书

在过去十年左右的时间里，C++发生了很大的变化。一些以前对语言很熟悉的人可能会因为要学习的新事物太多而感到沮丧。这不必那么困难。现在跟上进度将使跟踪 C++的持续变化和演变变得更容易。这本书专注于使用 C++各个部分的小型项目，而不是整个语言的阐述。你将在旅途中尝试一些想法，并学习语言特性，而不是通过一行示例逐个部分地深入语言语法和标准库。第一章是介绍，从第二章到最后一章，你将创建小型项目和游戏来帮助你学习。你甚至可能会觉得很有趣！

### 谁应该阅读这本书

如果你以前使用过 C++但未能跟上最近的变化，这本书适合你。如果你曾经是专家，但现在你的知识变得模糊，并且你想重新提高水平，这本书将帮助你。如果你以前从未是专家，但以前使用过一些 C++并想学习更多，特别是新的方法和功能，这本书也将非常有价值。

### 这本书是如何组织的：路线图

这本书有九个章节。第一章提供介绍，其余章节专注于编码的谜题或游戏。在某些情况下，我们首先制作一个简化版本，然后再改进游戏。在所有情况下，我们都专注于 C++的一个或多个主要特性，并在旅途中学习各种其他想法和方法：

+   第一章提供了关于 C++的背景信息，展示了它的相关性和实用性，并介绍了一些最近的变化。

+   第二章使用`std::vector`创建帕斯卡三角形。它还涵盖了移动语义、使用`std::format`、范围和 lambda 表达式。

+   第三章使用随机数来制作一个猜数字游戏。它还介绍了`std::optional`、`std::function`和用户输入的处理。

+   第四章使用`std::chrono`中的时间点和持续时间来编写倒计时。我们还遇到了用户字面量，并学习了`std::ratio`。

+   第五章涵盖了编写类来构建一副牌并玩高低牌游戏。它还涵盖了作用域枚举、`std::array`、三向比较运算符和`std::variant`。

+   第六章再次使用类来让一些“blob”从纸袋中跑出来，这次修订了继承并详细介绍了现在 C++中可用的新特殊成员函数。此外，它还涵盖了零规则、类型特性和智能指针。

+   第七章使用`std::map`和`std::multimap`构建一个答案砸游戏。这些容器并不新鲜，但我们看到了如何使用结构化绑定与`std::pair`和`std::tuple`一起使用，使我们能够整洁地查询映射。此外，我们还从文件中读取数据。

+   第八章使用了较新的`std::unordered_map`并描述了`std::hash`，以构建一个读心机，或者至少是一个根据先前结果猜测您将选择正面还是反面的程序。它还展示了如何将读心机转换为协程。

+   第九章通过详细介绍参数包和`std::visit`来结束全书，展示了如何制作老虎机游戏。本章鼓励您使用各种算法、`std::format`和 lambda 进行更多练习。

首先，阅读第一章，然后准备好您选择的编译器。您**可以**按任何顺序阅读章节；然而，它们在某种程度上相互关联，尽管每个章节都创建了一个自包含的项目。当某个功能再次使用时，首次提及会有标记，这样您就可以在需要时跳回。按顺序阅读章节可能更容易，因为您会逐渐将新的方法添加到您的技能库中。无论您如何决定阅读这本书，都请停下来尝试一些代码。然后玩您创建的游戏，或者与项目互动。保持头脑清醒，提问，实验，最重要的是，享受乐趣！

### 关于代码

这本书包含了许多源代码示例，既有编号列表，也有与普通文本混排的。在两种情况下，源代码都使用固定宽度字体格式化，以将其与普通文本区分开来。有时，代码也会加粗，以突出显示章节中从先前步骤中更改的代码，例如当新功能添加到现有代码行时。

在许多情况下，原始源代码已被重新格式化；我们添加了换行并重新调整了缩进，以适应书中的可用页面空间。此外，当代码在文本中描述时，源代码中的注释通常也会从列表中移除。代码注释伴随许多列表，突出显示重要概念。

本书的所有九章都包含代码。代码都在书中，但可以从[`github.com/doctorlove/BootstrapCpp.git`](https://github.com/doctorlove/BootstrapCpp.git)克隆。第一章是一个简短的`main`函数，用于讨论 C++的现代方法，而有趣的游戏从第二章开始。您需要一个编译器，[`isocpp.org/get-started`](https://isocpp.org/get-started)提供了几个优秀的免费编译器的链接。一些功能，如`std::format`，并非所有编译器都支持，但本书会指出这一点，源代码中的注释也会显示替代方案。

您可以从本书的 liveBook（在线）版本中获取可执行的代码片段，网址为[`livebook.manning.com/book/learn-c-plus-plus-by-example`](https://livebook.manning.com/book/learn-c-plus-plus-by-example)。本书中示例的完整代码可以从 Manning 网站下载，网址为[`www.manning.com/books/learn-c-plus-plus-by-example`](https://www.manning.com/books/learn-c-plus-plus-by-example)。

### liveBook 讨论论坛

购买《通过示例学习 C++》包括对 Manning 的在线阅读平台 liveBook 的免费访问。使用 liveBook 的独特讨论功能，您可以在全球范围内或针对特定的章节或段落附加评论。为自己做笔记、提出和回答技术问题，以及从作者和其他用户那里获得帮助都非常简单。要访问论坛，请访问[`livebook.manning.com/book/learn-c-plus-plus-by-example/discussion`](https://livebook.manning.com/book/learn-c-plus-plus-by-example/discussion)。您还可以在[`livebook.manning.com/discussion`](https://livebook.manning.com/discussion)了解更多关于 Manning 的论坛和行为的规则。

Manning 对我们读者的承诺是提供一个场所，在这里个人读者之间以及读者与作者之间可以进行有意义的对话。这不是对作者参与特定数量活动的承诺，作者对论坛的贡献仍然是自愿的（且未付费）。我们建议您尝试向作者提出一些挑战性的问题，以免他们的兴趣偏离！只要这本书还在印刷中，论坛和先前讨论的存档将可通过出版商的网站访问。

### 其他资源

每一章都提到了进一步的资源，这些资源被汇总在本书的附录中，因此您可以轻松回顾，而无需做笔记。

## 关于作者

Frances Buontempo 拥有多年的 C++经验。她曾在伦敦的几家公司的程序员工作，主要专注于金融。她喜欢测试和删除代码，并努力持续学习。她在 YouTube 上发表了关于 C++及其他内容的演讲。她是 ACCU 的《Overload》杂志的编辑，并乐意考虑来自想要分享从这本书中学到的东西的读者的文章。

## 关于封面插图

《通过示例学习 C++》封面上的图像是“莱姆诺斯岛女人”，或“莱姆诺斯岛的女性”，取自雅克·格拉塞·德·圣索沃尔的收藏，1788 年出版。每一幅插图都是手工精心绘制和着色的。

在那些日子里，仅凭人们的服饰就能轻易识别他们居住的地方以及他们的职业或社会地位。Manning 通过基于几个世纪前丰富多样的地域文化的书封面，庆祝计算机行业的创新精神和主动性，这些文化通过像这样的一些收藏品中的图片被重新带回生活。
